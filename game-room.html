<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Â§©‰∏ãÂ§™Âπ≥ - <span data-i18n="one_v_one">1v1</span></title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        .game-mode-banner {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            text-align: center;
            margin-bottom: 15px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .game-mode-badge {
            background-color: #e67e22;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .game-mode-badge.insane {
            background-color: #e74c3c;
        }
        
        .game-mode-badge.beta {
            background-color: #3498db;
        }
        
        .game-mode-description {
            font-size: 0.85rem;
            color: #bdc3c7;
            flex-grow: 1;
            margin: 0 15px;
        }
        
        .unit-option {
            position: relative;
        }
        
        .unit-option .unit-modifier {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .unit-option .unit-ability {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #2ecc71;
            border-radius: 8px;
            padding: 2px 5px;
            font-size: 10px;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div id="language-selector"></div>
    <div class="header">
        <a href="/" class="site-title" data-i18n="title">Â§©‰∏ãÂ§™Âπ≥</a>
        <div class="auth-links" id="auth-links">
            <a href="/login.html" data-i18n="login">ÁôªÂΩï</a>
            <a href="/signup.html" data-i18n="signup">Ê≥®ÂÜå</a>
        </div>
    </div>

    <div class="game-room-container">
        <h2><span data-i18n="one_v_one">1v1</span></h2>
        
        <div id="game-mode-banner" class="game-mode-banner" style="display: none;">
            <span id="game-mode-badge" class="game-mode-badge">Classic</span>
            <span id="game-mode-description" class="game-mode-description">Standard game mode with balanced gameplay.</span>
            <select id="game-mode-selector" style="display: none;">
                <option value="classic">Classic</option>
                <option value="insane">Insane</option>
                <option value="beta">Beta</option>
            </select>
        </div>
        
        <div class="room-info">
            <p><span data-i18n="player_count">Áé©ÂÆ∂Êï∞Èáè</span>: <span id="player-count">1</span></p>
            <p><span data-i18n="room_id">ÊàøÈó¥Âè∑</span>: <span id="room-id"></span></p>
            <button id="copy-room-link" class="action-button copy" data-i18n="copy_room_link">Â§çÂà∂ÊàøÈó¥ÈìæÊé•</button>
        </div>
        
        <div class="player-list">
            <h3 data-i18n="player_list">Áé©ÂÆ∂ÂàóË°®</h3>
            <ul id="players"></ul>
        </div>
        
        <div class="room-actions">
            <button id="start-game-btn" class="action-button start" data-i18n="start_game">ÂºÄÂßãÊ∏∏Êàè</button>
            <button id="leave-room-btn" class="action-button leave" data-i18n="leave_room">Á¶ªÂºÄÊàøÈó¥</button>
        </div>

        <!-- Game container that appears when game starts -->
        <div id="game-container" style="display: none;">
            <div class="game-header">
                <div class="player-info left">
                    <span class="player-name"></span>
                    <div class="hp-bar">
                        <div class="hp-fill"></div>
                    </div>
                    
                    <div class="gold-display">
                        <img src="images/coin.png" alt="Gold" class="gold-icon">
                        <span class="gold-amount">0</span>
                    </div>
                </div>
                <div class="rps-status">
                    <div id="rps-message">Choose rock, paper, or scissors</div>
                    <div id="rps-timer" style="display: none;">Next round: <span id="timer-count">10</span>s</div>
                    <div class="player-controls">
                        <div class="rps-controls" id="player-controls">
                            <button class="rps-btn" data-choice="rock">‚úä</button>
                            <button class="rps-btn" data-choice="paper">‚úã</button>
                            <button class="rps-btn" data-choice="scissors">‚úåÔ∏è</button>
                        </div>
                        <div class="rps-result" id="player-choice"></div>
                    </div>
                </div>
                <div class="player-info right">
                    <span class="player-name" id="opponent-name"></span>
                    <div class="hp-bar">
                        <div class="hp-fill"></div>
                    </div>
                    <div class="opponent-controls">
                        <div class="rps-result" id="opponent-choice"></div>
                    </div>
                    <div class="gold-display">
                        <img src="images/coin.png" alt="Gold" class="gold-icon">
                        <span class="gold-amount">0</span>
                    </div>
                </div>
            </div>
            <div class="game-field">
                <div class="tower left" style="z-index:2; position:absolute; left:0; top:50%; transform:translateY(-50%);">
                    <img src="images/tower.png" alt="Left Tower" class="tower-image">
                    <img src="images/barrier.png" alt="Barrier" class="barrier-image" style="display:none;">
                </div>
                <div class="tower right" style="z-index:1; position:absolute; right:0; top:50%; transform:translateY(-50%);">
                    <img src="images/tower.png" alt="Right Tower" class="tower-image">
                    <img src="images/barrier.png" alt="Barrier" class="barrier-image" style="display:none;">
                </div>
                <!-- Static minerals -->
                <div class="mineral left">
                    <img src="images/mineral.png" alt="Left Mineral" class="mineral-image">
                </div>
                <div class="mineral right">
                    <img src="images/mineral.png" alt="Right Mineral" class="mineral-image">
                </div>
            </div>
            <div id="unit-selection-bar" class="unit-selection-bar">
                <!-- Units will be dynamically populated based on game mode -->
            </div>
        </div>
    </div>
    
    <script src="js/common.js"></script>
    <script type="module">
        import i18n from './js/i18n.js';
        import { createLanguageSelector } from './js/language-selector.js';
        
        // Game mode configurations
        const gameModes = {
            classic: {
                name: "Classic",
                description: "Standard game mode with balanced gameplay.",
                initialGold: 500,
                miningRate: 50,
                units: [
                    { type: "miner", cost: 100, health: 100, speed: 1, description: "Collects resources" },
                    { type: "soldier", cost: 200, health: 200, damage: 10, speed: 1, description: "Attacks enemies" },
                    { type: "barrier", cost: 50, health: 300, description: "Defensive structure" }
                ]
            },
            insane: {
                name: "Insane",
                description: "Fast-paced chaos with powerful units and rapid resource generation.",
                initialGold: 1000,
                miningRate: 100,
                units: [
                    { type: "miner", cost: 100, health: 80, speed: 1.5, description: "Collects resources quickly", modifier: "‚ö°" },
                    { type: "soldier", cost: 250, health: 250, damage: 20, speed: 1.3, description: "Powerful attacker", modifier: "üí™" },
                    { type: "barrier", cost: 75, health: 500, description: "Reinforced barrier", modifier: "üõ°Ô∏è" },
                    { type: "berserker", cost: 400, health: 180, damage: 40, speed: 1.8, description: "High damage, low health", ability: "Frenzy" }
                ]
            },
            beta: {
                name: "Beta",
                description: "Experimental features and unique gameplay elements.",
                initialGold: 700,
                miningRate: 65,
                units: [
                    { type: "miner", cost: 120, health: 120, speed: 1, description: "Enhanced resource collector", ability: "Find Bonus" },
                    { type: "soldier", cost: 220, health: 180, damage: 15, speed: 1, description: "Balanced attacker", ability: "Stun" },
                    { type: "barrier", cost: 60, health: 350, description: "Expandable barrier", ability: "Repair" },
                    { type: "scout", cost: 150, health: 90, damage: 5, speed: 2, description: "Fast movement, reveals map", ability: "Stealth" }
                ]
            }
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            i18n.init();
            createLanguageSelector('language-selector');
            
            // Show the game mode banner for hosts
            const checkIfHost = () => {
                const players = document.querySelectorAll('#players li');
                for (const player of players) {
                    if (player.classList.contains('host') && player.classList.contains('current-player')) {
                        document.getElementById('game-mode-selector').style.display = 'block';
                        return true;
                    }
                }
                document.getElementById('game-mode-selector').style.display = 'none';
                return false;
            };
            
            // Set up game mode selector
            const modeSelector = document.getElementById('game-mode-selector');
            const modeBanner = document.getElementById('game-mode-banner');
            const modeBadge = document.getElementById('game-mode-badge');
            const modeDescription = document.getElementById('game-mode-description');
            
            // Show game mode banner
            modeBanner.style.display = 'flex';
            
            // Check URL for game mode parameter
            const urlParams = new URLSearchParams(window.location.search);
            const modeParam = urlParams.get('mode');
            
            if (modeParam && gameModes[modeParam]) {
                modeSelector.value = modeParam;
                updateGameModeBanner(modeParam);
            } else {
                // Default to classic
                updateGameModeBanner('classic');
            }
            
            // Function to update the game mode banner
            function updateGameModeBanner(mode) {
                const modeConfig = gameModes[mode];
                modeBadge.textContent = modeConfig.name;
                modeBadge.className = `game-mode-badge ${mode}`;
                modeDescription.textContent = modeConfig.description;
                
                // Update URL without reloading page
                const url = new URL(window.location);
                url.searchParams.set('mode', mode);
                window.history.pushState({}, '', url);
                
                // Apply game mode to the socket connection
                if (window.socket) {
                    window.socket.emit('setGameMode', { mode });
                }
                
                // Update unit selection based on game mode
                updateUnitSelection(mode);
            }
            
            // Function to update unit selection based on game mode
            function updateUnitSelection(mode) {
                const unitBar = document.getElementById('unit-selection-bar');
                if (!unitBar) return;
                
                unitBar.innerHTML = '';
                
                const modeConfig = gameModes[mode];
                modeConfig.units.forEach(unit => {
                    const unitElement = document.createElement('div');
                    unitElement.className = 'unit-option';
                    unitElement.dataset.unit = unit.type;
                    
                    let unitHtml = `
                        <img src="images/${unit.type}.png" alt="${unit.type}" class="unit-icon">
                        <span class="unit-cost">${unit.cost}</span>
                    `;
                    
                    if (unit.modifier) {
                        unitHtml += `<span class="unit-modifier">${unit.modifier}</span>`;
                    }
                    
                    if (unit.ability) {
                        unitHtml += `<span class="unit-ability">${unit.ability}</span>`;
                    }
                    
                    unitElement.innerHTML = unitHtml;
                    unitBar.appendChild(unitElement);
                });
            }
            
            // Add event listener to game mode selector
            modeSelector.addEventListener('change', (e) => {
                updateGameModeBanner(e.target.value);
            });
            
            // Expose functions to the global scope to be used by the game-room.js file
            window.gameModeFunctions = {
                checkIfHost,
                getGameMode: () => modeSelector.value,
                getGameModeConfig: (mode) => gameModes[mode] || gameModes.classic,
                updateGameModeBanner,
                updateUnitSelection
            };
        });
    </script>
    <script type="module" src="js/pages/game-room.js"></script>
</body>
</html>